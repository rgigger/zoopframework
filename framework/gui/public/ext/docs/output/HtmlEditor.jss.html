<html><head><title>HtmlEditor.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>HtmlEditor.js</h1><pre class="highlighted"><code><i>/**
 * @class Ext.form.HtmlEditor
 * @extends Ext.form.Field
 * Provides a lightweight HTML Editor component.
 * &lt;br&gt;&lt;br&gt;&lt;b&gt;Note: The focus/blur and validation marking functionality inherited from Ext.form.Field is NOT
 * supported by <b>this</b> editor.&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
 * An Editor is a sensitive component that can't be used <b>in</b> all spots standard fields can be used. Putting an Editor within
 * any element that has display set to 'none' can cause problems <b>in</b> Safari and Firefox.
 */</i>

Ext.form.HtmlEditor = Ext.extend(Ext.form.Field, {
    <i>/**
     * @cfg {Boolean} enableFormat Enable the bold, italic and underline buttons (defaults to true)
     */</i>
    enableFormat : true,
    <i>/**
     * @cfg {Boolean} enableFontSize Enable the increase/decrease font size buttons (defaults to true)
     */</i>
    enableFontSize : true,
    <i>/**
     * @cfg {Boolean} enableColors Enable the fore/highlight color buttons (defaults to true)
     */</i>
    enableColors : true,
    <i>/**
     * @cfg {Boolean} enableAlignments Enable the left, center, right alignment buttons (defaults to true)
     */</i>
    enableAlignments : true,
    <i>/**
     * @cfg {Boolean} enableLists Enable the bullet and numbered list buttons. Not available <b>in</b> Safari. (defaults to true)
     */</i>
    enableLists : true,
    <i>/**
     * @cfg {Boolean} enableSourceEdit Enable the <b>switch</b> to source edit button. Not available <b>in</b> Safari. (defaults to true)
     */</i>
    enableSourceEdit : true,
    <i>/**
     * @cfg {Boolean} enableLinks Enable the create link button. Not available <b>in</b> Safari. (defaults to true)
     */</i>
    enableLinks : true,
    <i>/**
     * @cfg {Boolean} enableFont Enable font selection. Not available <b>in</b> Safari. (defaults to true)
     */</i>
    enableFont : true,

    <i>/**
     * @cfg {String} createLinkText The <b>default</b> text <b>for</b> the create link prompt
     */</i>
    createLinkText : 'Please enter the URL <b>for</b> the link:',

    <i>/**
     * @cfg {String} defaultLinkValue The <b>default</b> value <b>for</b> the create link prompt (defaults to http:/ /)
     */</i>
    defaultLinkValue : 'http:/'+'/',

    <i>/**
     * @cfg {Array} fontFamilies An array of available font families
     */</i>
    fontFamilies : [
        'Arial',
        'Courier New',
        'Tahoma',
        'Times New Roman',
        'Verdana'
    ],
    defaultFont: 'tahoma',

    <i>// private properties</i>
    validationEvent : false,
    deferHeight: true,
    initialized : false,
    activated : false,
    sourceEditMode : false,
    onFocus : Ext.emptyFn,
    iframePad:3,
    hideMode:'offsets',
    defaultAutoCreate : {
        tag: &quot;textarea&quot;,
        style:&quot;width:500px;height:300px;&quot;,
        autocomplete: &quot;off&quot;
    },

    <i>// private</i>
    initComponent : <b>function</b>(){
        <b>this</b>.addEvents({
            <i>/**
             * @event initialize
             * Fires when the editor is fully initialized (including the iframe)
             * @param {HtmlEditor} <b>this</b>
             */</i>
            initialize: true,
            <i>/**
             * @event activate
             * Fires when the editor is first receives the focus. Any insertion must wait
             * until after <b>this</b> event.
             * @param {HtmlEditor} <b>this</b>
             */</i>
            activate: true,
             <i>/**
             * @event beforesync
             * Fires before the textarea is updated <b>with</b> content from the editor iframe. Return false
             * to cancel the sync.
             * @param {HtmlEditor} <b>this</b>
             * @param {String} html
             */</i>
            beforesync: true,
             <i>/**
             * @event beforepush
             * Fires before the iframe editor is updated <b>with</b> content from the textarea. Return false
             * to cancel the push.
             * @param {HtmlEditor} <b>this</b>
             * @param {String} html
             */</i>
            beforepush: true,
             <i>/**
             * @event sync
             * Fires when the textarea is updated <b>with</b> content from the editor iframe.
             * @param {HtmlEditor} <b>this</b>
             * @param {String} html
             */</i>
            sync: true,
             <i>/**
             * @event push
             * Fires when the iframe editor is updated <b>with</b> content from the textarea.
             * @param {HtmlEditor} <b>this</b>
             * @param {String} html
             */</i>
            push: true,
             <i>/**
             * @event editmodechange
             * Fires when the editor switches edit modes
             * @param {HtmlEditor} <b>this</b>
             * @param {Boolean} sourceEdit True <b>if</b> source edit, false <b>if</b> standard editing.
             */</i>
            editmodechange: true
        })
    },

    createFontOptions : <b>function</b>(){
        <b>var</b> buf = [], fs = <b>this</b>.fontFamilies, ff, lc;
        <b>for</b>(var i = 0, len = fs.length; i&lt; len; i++){
            ff = fs[i];
            lc = ff.toLowerCase();
            buf.push(
                '&lt;option value=&quot;',lc,'&quot; style=&quot;font-family:',ff,';&quot;',
                    (<b>this</b>.defaultFont == lc ? ' selected=&quot;true&quot;&gt;' : '&gt;'),
                    ff,
                '&lt;/option&gt;'
            );
        }
        <b>return</b> buf.join('');
    },
    <i>/**
     * Protected method that will not generally be called directly. It
     * is called when the editor creates its toolbar. Override <b>this</b> method <b>if</b> you need to
     * add custom toolbar buttons.
     * @param {HtmlEditor} editor
     */</i>
    createToolbar : <b>function</b>(editor){

        <b>function</b> btn(id, toggle, handler){
            <b>return</b> {
                id : id,
                cls : 'x-btn-icon x-edit-'+id,
                enableToggle:toggle !== false,
                scope: editor,
                handler:handler||editor.relayBtnCmd,
                clickEvent:'mousedown',
                tooltip: editor.buttonTips[id] || undefined,
                tabIndex:-1
            };
        }

        <i>// build the toolbar</i>
        <b>var</b> tb = <b>new</b> Ext.Toolbar(<b>this</b>.wrap.dom.firstChild);

        <i>// stop form submits</i>
        tb.el.on('click', <b>function</b>(e){
            e.preventDefault();
        });

        <b>if</b>(this.enableFont &amp;&amp; !Ext.isSafari){
            <b>this</b>.fontSelect = tb.el.createChild({
                tag:'select',
                tabIndex: -1,
                cls:'x-font-select',
                html: <b>this</b>.createFontOptions()
            });
            <b>this</b>.fontSelect.on('change', <b>function</b>(){
                <b>var</b> font = <b>this</b>.fontSelect.dom.value;
                <b>this</b>.relayCmd('fontname', font);
                <b>this</b>.deferFocus();
            }, <b>this</b>);
            tb.add(
                <b>this</b>.fontSelect.dom,
                '-'
            );
        };

        <b>if</b>(this.enableFormat){
            tb.add(
                btn('bold'),
                btn('italic'),
                btn('underline')
            );
        };

        <b>if</b>(this.enableFontSize){
            tb.add(
                '-',
                btn('increasefontsize', false, <b>this</b>.adjustFont),
                btn('decreasefontsize', false, <b>this</b>.adjustFont)
            );
        };

        <b>if</b>(this.enableColors){
            tb.add(
                '-', {
                    id:'forecolor',
                    cls:'x-btn-icon x-edit-forecolor',
                    clickEvent:'mousedown',
                    tooltip: editor.buttonTips['forecolor'] || undefined,
                    tabIndex:-1,
                    menu : <b>new</b> Ext.menu.ColorMenu({
                        allowReselect: true,
                        focus: Ext.emptyFn,
                        value:'000000',
                        plain:true,
                        selectHandler: <b>function</b>(cp, color){
                            <b>this</b>.execCmd('forecolor', Ext.isSafari || Ext.isIE ? '#'+color : color);
                            <b>this</b>.deferFocus();
                        },
                        scope: <b>this</b>,
                        clickEvent:'mousedown'
                    })
                }, {
                    id:'backcolor',
                    cls:'x-btn-icon x-edit-backcolor',
                    clickEvent:'mousedown',
                    tooltip: editor.buttonTips['backcolor'] || undefined,
                    tabIndex:-1,
                    menu : <b>new</b> Ext.menu.ColorMenu({
                        focus: Ext.emptyFn,
                        value:'FFFFFF',
                        plain:true,
                        allowReselect: true,
                        selectHandler: <b>function</b>(cp, color){
                            <b>if</b>(Ext.isGecko){
                                <b>this</b>.execCmd('useCSS', false);
                                <b>this</b>.execCmd('hilitecolor', color);
                                <b>this</b>.execCmd('useCSS', true);
                                <b>this</b>.deferFocus();
                            }<b>else</b>{
                                <b>this</b>.execCmd(Ext.isOpera ? 'hilitecolor' : 'backcolor', Ext.isSafari || Ext.isIE ? '#'+color : color);
                                <b>this</b>.deferFocus();
                            }
                        },
                        scope:<b>this</b>,
                        clickEvent:'mousedown'
                    })
                }
            );
        };

        <b>if</b>(this.enableAlignments){
            tb.add(
                '-',
                btn('justifyleft'),
                btn('justifycenter'),
                btn('justifyright')
            );
        };

        <b>if</b>(!Ext.isSafari){
            <b>if</b>(this.enableLinks){
                tb.add(
                    '-',
                    btn('createlink', false, <b>this</b>.createLink)
                );
            };

            <b>if</b>(this.enableLists){
                tb.add(
                    '-',
                    btn('insertorderedlist'),
                    btn('insertunorderedlist')
                );
            }
            <b>if</b>(this.enableSourceEdit){
                tb.add(
                    '-',
                    btn('sourceedit', true, <b>function</b>(btn){
                        <b>this</b>.toggleSourceEdit(btn.pressed);
                    })
                );
            }
        }

        <b>this</b>.tb = tb;
    },

    <i>/**
     * Protected method that will not generally be called directly. It
     * is called when the editor initializes the iframe <b>with</b> HTML contents. Override <b>this</b> method <b>if</b> you
     * want to change the initialization markup of the iframe (e.g. to add stylesheets).
     */</i>
    getDocMarkup : <b>function</b>(){
        <b>return</b> '&lt;html&gt;&lt;head&gt;&lt;style type=&quot;text/css&quot;&gt;body{border:0;margin:0;padding:3px;height:98%;cursor:text;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;';
    },

    <i>// private</i>
    onRender : <b>function</b>(ct, position){
        Ext.form.HtmlEditor.superclass.onRender.call(<b>this</b>, ct, position);
        <b>this</b>.el.dom.style.border = '0 none';
        <b>this</b>.el.addClass('x-hidden');
        <b>if</b>(Ext.isIE){ <i>// fix IE 1px bogus margin</i>
            <b>this</b>.el.applyStyles('margin-top:-1px;margin-bottom:-1px;')
        }
        <b>this</b>.wrap = <b>this</b>.el.wrap({
            cls:'x-html-editor-wrap', cn:{cls:'x-html-editor-tb'}
        });


        <b>this</b>.createToolbar(<b>this</b>);

        <b>this</b>.tb.items.each(<b>function</b>(item){
           <b>if</b>(item.id != 'sourceedit'){
                item.disable();
            }
        });

        <b>var</b> iframe = document.createElement('iframe');
        iframe.name = Ext.id();
        iframe.frameBorder = 'no';

        iframe.src=&quot;javascript:false&quot;;

        <b>this</b>.wrap.dom.appendChild(iframe);

        <b>this</b>.iframe = iframe;

        <b>if</b>(Ext.isIE){
            <b>this</b>.doc = iframe.contentWindow.document;
            <b>this</b>.win = iframe.contentWindow;
        } <b>else</b> {
            <b>this</b>.doc = (iframe.contentDocument || window.frames[iframe.name].document);
            <b>this</b>.win = window.frames[iframe.name];
        }
        <b>this</b>.doc.designMode = 'on';
        <b>this</b>.doc.open();
        <b>this</b>.doc.write(<b>this</b>.getDocMarkup())
        <b>this</b>.doc.close();

        <b>var</b> task = { <i>// must defer to wait <b>for</b> browser to be ready</i>
            run : <b>function</b>(){
                <b>if</b>(this.doc.body || <b>this</b>.doc.readyState == 'complete'){
                    <b>this</b>.doc.designMode=&quot;on&quot;;
                    Ext.TaskMgr.stop(task);
                    <b>this</b>.initEditor.defer(10, <b>this</b>);
                }
            },
            interval : 10,
            duration:10000,
            scope: <b>this</b>
        };
        Ext.TaskMgr.start(task);

        <b>if</b>(!<b>this</b>.width){
            <b>this</b>.setSize(<b>this</b>.el.getSize());
        }
    },

    <i>// private</i>
    onResize : <b>function</b>(w, h){
        Ext.form.HtmlEditor.superclass.onResize.apply(<b>this</b>, arguments);
        <b>if</b>(this.el &amp;&amp; <b>this</b>.iframe){
            <b>if</b>(typeof w == 'number'){
                <b>var</b> aw = w - <b>this</b>.wrap.getFrameWidth('lr');
                <b>this</b>.el.setWidth(<b>this</b>.adjustWidth('textarea', aw));
                <b>this</b>.iframe.style.width = aw + 'px';
            }
            <b>if</b>(typeof h == 'number'){
                <b>var</b> ah = h - <b>this</b>.wrap.getFrameWidth('tb') - <b>this</b>.tb.el.getHeight();
                <b>this</b>.el.setHeight(<b>this</b>.adjustWidth('textarea', ah));
                <b>this</b>.iframe.style.height = ah + 'px';
                <b>if</b>(this.doc){
                    (<b>this</b>.doc.body || <b>this</b>.doc.documentElement).style.height = (ah - (<b>this</b>.iframePad*2)) + 'px';
                }
            }
        }
    },

    <i>/**
     * Toggles the editor between standard and source edit mode.
     * @param {Boolean} sourceEdit (optional) True <b>for</b> source edit, false <b>for</b> standard
     */</i>
    toggleSourceEdit : <b>function</b>(sourceEditMode){
        <b>if</b>(sourceEditMode === undefined){
            sourceEditMode = !<b>this</b>.sourceEditMode;
        }
        <b>this</b>.sourceEditMode = sourceEditMode === true;
        <b>var</b> btn = <b>this</b>.tb.items.get('sourceedit');
        <b>if</b>(btn.pressed !== <b>this</b>.sourceEditMode){
            btn.toggle(<b>this</b>.sourceEditMode);
            <b>return</b>;
        }
        <b>if</b>(this.sourceEditMode){
            <b>this</b>.tb.items.each(<b>function</b>(item){
                <b>if</b>(item.id != 'sourceedit'){
                    item.disable();
                }
            });
            <b>this</b>.syncValue();
            <b>this</b>.iframe.className = 'x-hidden';
            <b>this</b>.el.removeClass('x-hidden');
            <b>this</b>.el.focus();
        }<b>else</b>{
            <b>if</b>(this.initialized){
                <b>this</b>.tb.items.each(<b>function</b>(item){
                    item.enable();
                });
            }
            <b>this</b>.pushValue();
            <b>this</b>.iframe.className = '';
            <b>this</b>.el.addClass('x-hidden');
            <b>this</b>.deferFocus();
        }
        <b>this</b>.setSize(<b>this</b>.wrap.getSize());
        <b>this</b>.fireEvent('editmodechange', <b>this</b>, <b>this</b>.sourceEditMode);
    },

    <i>// private used internally</i>
    createLink : <b>function</b>(){
        <b>var</b> url = prompt(<b>this</b>.createLinkText, <b>this</b>.defaultLinkValue);
        <b>if</b>(url &amp;&amp; url != 'http:/'+'/'){
            <b>this</b>.relayCmd('createlink', url);
        }
    },

    <i>// private (<b>for</b> BoxComponent)</i>
    adjustSize : Ext.BoxComponent.prototype.adjustSize,

    <i>// private (<b>for</b> BoxComponent)</i>
    getResizeEl : <b>function</b>(){
        <b>return</b> this.wrap;
    },

    <i>// private (<b>for</b> BoxComponent)</i>
    getPositionEl : <b>function</b>(){
        <b>return</b> this.wrap;
    },

    <i>// private</i>
    initEvents : <b>function</b>(){
        <b>this</b>.originalValue = <b>this</b>.getValue();
    },

    <i>/**
     * Overridden and disabled. The editor element does not support standard valid/invalid marking. @hide
     * @method
     */</i>
    markInvalid : Ext.emptyFn,
    <i>/**
     * Overridden and disabled. The editor element does not support standard valid/invalid marking. @hide
     * @method
     */</i>
    clearInvalid : Ext.emptyFn,

    setValue : <b>function</b>(v){
        Ext.form.HtmlEditor.superclass.setValue.call(<b>this</b>, v);
        <b>this</b>.pushValue();
    },

    <i>/**
     * Protected method that will not generally be called directly. If you need/want
     * custom HTML cleanup, <b>this</b> is the method you should override.
     * @param {String} html The HTML to be cleaned
     * <b>return</b> {String} The cleaned HTML
     */</i>
    cleanHtml : <b>function</b>(html){
        html = String(html);
        <b>if</b>(html.length &gt; 5){
            <b>if</b>(Ext.isSafari){ <i>// strip safari nonsense</i>
                html = html.replace(/\sclass=&quot;(?:Apple-style-span|khtml-block-placeholder)&quot;/gi, '');
            }
        }
        <b>if</b>(html == '&amp;nbsp;'){
            html = '';
        }
        <b>return</b> html;
    },

    <i>/**
     * Protected method that will not generally be called directly. Syncs the contents
     * of the editor iframe <b>with</b> the textarea.
     */</i>
    syncValue : <b>function</b>(){
        <b>if</b>(this.initialized){
            <b>var</b> bd = (<b>this</b>.doc.body || <b>this</b>.doc.documentElement);
            <b>var</b> html = bd.innerHTML;
            <b>if</b>(Ext.isSafari){
                <b>var</b> bs = bd.getAttribute('style'); <i>// Safari puts text-align styles on the body element!</i>
                <b>var</b> m = bs.match(/text-align:(.*?);/i);
                <b>if</b>(m &amp;&amp; m[1]){
                    html = '&lt;div style=&quot;'+m[0]+'&quot;&gt;' + html + '&lt;/div&gt;';
                }
            }
            html = <b>this</b>.cleanHtml(html);
            <b>if</b>(this.fireEvent('beforesync', <b>this</b>, html) !== false){
                <b>this</b>.el.dom.value = html;
                <b>this</b>.fireEvent('sync', <b>this</b>, html);
            }
        }
    },

    <i>/**
     * Protected method that will not generally be called directly. Pushes the value of the textarea
     * into the iframe editor.
     */</i>
    pushValue : <b>function</b>(){
        <b>if</b>(this.initialized){
            <b>var</b> v = <b>this</b>.el.dom.value;
            <b>if</b>(v.length &lt; 1){
                v = '&amp;nbsp;';
            }
            <b>if</b>(this.fireEvent('beforepush', <b>this</b>, v) !== false){
                (<b>this</b>.doc.body || <b>this</b>.doc.documentElement).innerHTML = v;
                <b>this</b>.fireEvent('push', <b>this</b>, v);
            }
        }
    },

    <i>// private</i>
    deferFocus : <b>function</b>(){
        <b>this</b>.focus.defer(10, <b>this</b>);
    },

    <i>// doc'ed <b>in</b> Field</i>
    focus : <b>function</b>(){
        <b>if</b>(this.win &amp;&amp; !<b>this</b>.sourceEditMode){
            <b>this</b>.win.focus();
        }<b>else</b>{
            <b>this</b>.el.focus();
        }
    },

    <i>// private</i>
    initEditor : <b>function</b>(){
        <b>var</b> dbody = (<b>this</b>.doc.body || <b>this</b>.doc.documentElement);
        <b>var</b> ss = <b>this</b>.el.getStyles('font-size', 'font-family', 'background-image', 'background-repeat');
        ss['background-attachment'] = 'fixed'; <i>// w3c</i>
        dbody.bgProperties = 'fixed'; <i>// ie</i>
        Ext.DomHelper.applyStyles(dbody, ss);
        Ext.EventManager.on(<b>this</b>.doc, {
            'mousedown': <b>this</b>.onEditorEvent,
            'dblclick': <b>this</b>.onEditorEvent,
            'click': <b>this</b>.onEditorEvent,
            'keyup': <b>this</b>.onEditorEvent,
            buffer:100,
            scope: <b>this</b>
        });
        <b>if</b>(Ext.isGecko){
            Ext.EventManager.on(<b>this</b>.doc, 'keypress', <b>this</b>.applyCommand, <b>this</b>);
        }
        <b>if</b>(Ext.isIE || Ext.isSafari || Ext.isOpera){
            Ext.EventManager.on(<b>this</b>.doc, 'keydown', <b>this</b>.fixKeys, <b>this</b>);
        }
        <b>this</b>.initialized = true;

        <b>this</b>.fireEvent('initialize', <b>this</b>);
        <b>this</b>.pushValue();
    },

    <i>// private</i>
    onDestroy : <b>function</b>(){
        <b>if</b>(this.rendered){
            <b>this</b>.tb.items.each(<b>function</b>(item){
                <b>if</b>(item.menu){
                    item.menu.removeAll();
                    <b>if</b>(item.menu.el){
                        item.menu.el.destroy();
                    }
                }
                item.destroy();
            });
            <b>this</b>.wrap.dom.innerHTML = '';
            <b>this</b>.wrap.remove();
        }
    },

    <i>// private</i>
    onFirstFocus : <b>function</b>(){
        <b>this</b>.activated = true;
        <b>this</b>.tb.items.each(<b>function</b>(item){
           item.enable();
        });
        <b>if</b>(Ext.isGecko){ <i>// prevent silly gecko errors</i>
            <b>this</b>.win.focus();
            <b>var</b> s = <b>this</b>.win.getSelection();
            <b>if</b>(!s.focusNode || s.focusNode.nodeType != 3){
                <b>var</b> r = s.getRangeAt(0);
                r.selectNodeContents((<b>this</b>.doc.body || <b>this</b>.doc.documentElement));
                r.collapse(true);
                <b>this</b>.deferFocus();
            }
            try{
                <b>this</b>.execCmd('useCSS', true);
                <b>this</b>.execCmd('styleWithCSS', false);
            }catch(e){}
        }
        <b>this</b>.fireEvent('activate', <b>this</b>);
    },

    <i>// private</i>
    adjustFont: <b>function</b>(btn){
        <b>var</b> adjust = btn.id == 'increasefontsize' ? 1 : -1;
        <b>if</b>(Ext.isSafari){ <i>// safari</i>
            adjust *= 2;
        }
        <b>var</b> v = parseInt(<b>this</b>.doc.queryCommandValue('FontSize')|| 3, 10);
        v = Math.max(1, v+adjust);
        <b>this</b>.execCmd('FontSize', v + (Ext.isSafari ? 'px' : 0));
    },

    onEditorEvent : <b>function</b>(e){
        <b>this</b>.updateToolbar();
    },


    <i>/**
     * Protected method that will not generally be called directly. It triggers
     * a toolbar update by reading the markup state of the current selection <b>in</b> the editor.
     */</i>
    updateToolbar: <b>function</b>(){

        <b>if</b>(!<b>this</b>.activated){
            <b>this</b>.onFirstFocus();
            <b>return</b>;
        }

        <b>var</b> btns = <b>this</b>.tb.items.map, doc = <b>this</b>.doc;

        <b>if</b>(this.enableFont &amp;&amp; !Ext.isSafari){
            <b>var</b> name = (<b>this</b>.doc.queryCommandValue('FontName')||<b>this</b>.defaultFont).toLowerCase();
            <b>if</b>(name != <b>this</b>.fontSelect.dom.value){
                <b>this</b>.fontSelect.dom.value = name;
            }
        }
        <b>if</b>(this.enableFormat){
            btns.bold.toggle(doc.queryCommandState('bold'));
            btns.italic.toggle(doc.queryCommandState('italic'));
            btns.underline.toggle(doc.queryCommandState('underline'));
        }
        <b>if</b>(this.enableAlignments){
            btns.justifyleft.toggle(doc.queryCommandState('justifyleft'));
            btns.justifycenter.toggle(doc.queryCommandState('justifycenter'));
            btns.justifyright.toggle(doc.queryCommandState('justifyright'));
        }
        <b>if</b>(!Ext.isSafari &amp;&amp; <b>this</b>.enableLists){
            btns.insertorderedlist.toggle(doc.queryCommandState('insertorderedlist'));
            btns.insertunorderedlist.toggle(doc.queryCommandState('insertunorderedlist'));
        }
        <b>if</b>(this.enableColors){
            btns.forecolor.menu.hide();
            btns.backcolor.menu.hide();
        }

        <b>this</b>.syncValue();
    },

    <i>// private</i>
    relayBtnCmd : <b>function</b>(btn){
        <b>this</b>.relayCmd(btn.id);
    },

    <i>/**
     * Executes a Midas editor command on the editor document and performs necessary focus and
     * toolbar updates. &lt;b&gt;This should only be called after the editor is initialized.&lt;/b&gt;
     * @param {String} cmd The Midas command
     * @param {String/Boolean} value (optional) The value to pass to the command (defaults to null)
     */</i>
    relayCmd : <b>function</b>(cmd, value){
        <b>this</b>.win.focus();
        <b>this</b>.execCmd(cmd, value);
        <b>this</b>.updateToolbar();
        <b>this</b>.deferFocus();
    },

    <i>/**
     * Executes a Midas editor command directly on the editor document.
     * For visual commands, you should use {@link #relayCmd} instead.
     * &lt;b&gt;This should only be called after the editor is initialized.&lt;/b&gt;
     * @param {String} cmd The Midas command
     * @param {String/Boolean} value (optional) The value to pass to the command (defaults to null)
     */</i>
    execCmd : <b>function</b>(cmd, value){
        <b>this</b>.doc.execCommand(cmd, false, value === undefined ? null : value);
        <b>this</b>.syncValue();
    },

    <i>// private</i>
    applyCommand : <b>function</b>(e){
        <b>if</b>(e.ctrlKey){
            <b>var</b> c = e.getCharCode(), cmd;
            <b>if</b>(c &gt; 0){
                c = String.fromCharCode(c);
                <b>switch</b>(c){
                    <b>case</b> 'b':
                        cmd = 'bold';
                    <b>break</b>;
                    <b>case</b> 'i':
                        cmd = 'italic';
                    <b>break</b>;
                    <b>case</b> 'u':
                        cmd = 'underline';
                    <b>break</b>;
                }
                <b>if</b>(cmd){
                    <b>this</b>.win.focus();
                    <b>this</b>.execCmd(cmd);
                    <b>this</b>.deferFocus();
                    e.preventDefault();
                }
            }
        }
    },

    <i>/**
     * Inserts the passed text at the current cursor position. Note: the editor must be initialized and activated
     * to insert text.
     * @param {String} text
     */</i>
    insertAtCursor : <b>function</b>(text){
        <b>if</b>(!<b>this</b>.activated){
            <b>return</b>;
        }
        <b>if</b>(Ext.isIE){
            <b>this</b>.win.focus();
            <b>var</b> r = <b>this</b>.doc.selection.createRange();
            <b>if</b>(r){
                r.collapse(true);
                r.pasteHTML(text);
                <b>this</b>.syncValue();
                <b>this</b>.deferFocus();
            }
        }<b>else</b> if(Ext.isGecko || Ext.isOpera){
            <b>this</b>.win.focus();
            <b>this</b>.execCmd('InsertHTML', text);
            <b>this</b>.deferFocus();
        }<b>else</b> if(Ext.isSafari){
            <b>this</b>.execCmd('InsertText', text);
            <b>this</b>.deferFocus();
        }
    },

    <i>// private</i>
    fixKeys : <b>function</b>(){ <i>// load time branching <b>for</b> fastest keydown performance</i>
        <b>if</b>(Ext.isIE){
            <b>return</b> function(e){
                <b>var</b> k = e.getKey(), r;
                <b>if</b>(k == e.TAB){
                    e.stopEvent();
                    r = <b>this</b>.doc.selection.createRange();
                    <b>if</b>(r){
                        r.collapse(true);
                        r.pasteHTML('&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;');
                        <b>this</b>.deferFocus();
                    }
                }<b>else</b> if(k == e.ENTER &amp;&amp; !e.getTarget('li')){
                    e.stopEvent();
                    r = <b>this</b>.doc.selection.createRange();
                    <b>if</b>(r){
                        r.pasteHTML('&lt;br /&gt;');
                        r.collapse(false);
                        r.select();
                    }
                }
            };
        }<b>else</b> if(Ext.isOpera){
            <b>return</b> function(e){
                <b>var</b> k = e.getKey();
                <b>if</b>(k == e.TAB){
                    e.stopEvent();
                    <b>this</b>.win.focus();
                    <b>this</b>.execCmd('InsertHTML','&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;');
                    <b>this</b>.deferFocus();
                }
            };
        }<b>else</b> if(Ext.isSafari){
            <b>return</b> function(e){
                <b>var</b> k = e.getKey();
                <b>if</b>(k == e.TAB){
                    e.stopEvent();
                    <b>this</b>.execCmd('InsertText','\t');
                    <b>this</b>.deferFocus();
                }
             };
        }
    }(),

    <i>/**
     * Returns the editor's toolbar. &lt;b&gt;This is only available after the editor has been rendered.&lt;/b&gt;
     * @<b>return</b> {Ext.Toolbar}
     */</i>
    getToolbar : <b>function</b>(){
        <b>return</b> this.tb;
    },

    <i>/**
     * Object collection of toolbar tooltips <b>for</b> the buttons <b>in</b> the editor. The key
     * is the command id associated <b>with</b> that button and the value is a valid QuickTips object.
     * For example:
&lt;pre&gt;&lt;code&gt;
{
    bold : {
        title: 'Bold (Ctrl+B)',
        text: 'Make the selected text bold.',
        cls: 'x-html-editor-tip'
    },
    italic : {
        title: 'Italic (Ctrl+I)',
        text: 'Make the selected text italic.',
        cls: 'x-html-editor-tip'
    },
    ...
&lt;/code&gt;&lt;/pre&gt;
    * @type Object
     */</i>
    buttonTips : {
        bold : {
            title: 'Bold (Ctrl+B)',
            text: 'Make the selected text bold.',
            cls: 'x-html-editor-tip'
        },
        italic : {
            title: 'Italic (Ctrl+I)',
            text: 'Make the selected text italic.',
            cls: 'x-html-editor-tip'
        },
        underline : {
            title: 'Underline (Ctrl+U)',
            text: 'Underline the selected text.',
            cls: 'x-html-editor-tip'
        },
        increasefontsize : {
            title: 'Grow Text',
            text: 'Increase the font size.',
            cls: 'x-html-editor-tip'
        },
        decreasefontsize : {
            title: 'Shrink Text',
            text: 'Decrease the font size.',
            cls: 'x-html-editor-tip'
        },
        backcolor : {
            title: 'Text Highlight Color',
            text: 'Change the background color of the selected text.',
            cls: 'x-html-editor-tip'
        },
        forecolor : {
            title: 'Font Color',
            text: 'Change the color of the selected text.',
            cls: 'x-html-editor-tip'
        },
        justifyleft : {
            title: 'Align Text Left',
            text: 'Align text to the left.',
            cls: 'x-html-editor-tip'
        },
        justifycenter : {
            title: 'Center Text',
            text: 'Center text <b>in</b> the editor.',
            cls: 'x-html-editor-tip'
        },
        justifyright : {
            title: 'Align Text Right',
            text: 'Align text to the right.',
            cls: 'x-html-editor-tip'
        },
        insertunorderedlist : {
            title: 'Bullet List',
            text: 'Start a bulleted list.',
            cls: 'x-html-editor-tip'
        },
        insertorderedlist : {
            title: 'Numbered List',
            text: 'Start a numbered list.',
            cls: 'x-html-editor-tip'
        },
        createlink : {
            title: 'Hyperlink',
            text: 'Make the selected text a hyperlink.',
            cls: 'x-html-editor-tip'
        },
        sourceedit : {
            title: 'Source Edit',
            text: 'Switch to source editing mode.',
            cls: 'x-html-editor-tip'
        }
    }

    <i>// hide stuff that is not compatible</i>
    <i>/**
     * @event blur
     * @hide
     */</i>
<i>// holder</i>
<i>/***
     * @event focus
     * @hide
     */</i>
<i>// holder</i>
<i>/***
     * @event specialkey
     * @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} fieldClass @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} focusClass @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} autoCreate @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} inputType @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} invalidClass @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} invalidText @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} msgFx @hide
     */</i>
<i>// holder</i>
<i>/***
     * @cfg {String} validateOnBlur @hide
     */</i>
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">Ext - Copyright &copy; 2006-2007 Ext JS, LLC<br />All rights reserved.</div>
    </body></html>